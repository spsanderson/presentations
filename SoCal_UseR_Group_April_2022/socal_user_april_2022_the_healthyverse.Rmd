---
title: "The {healthyverse}"
subtitle: "A Presentation to the SoCal RUG"
author: "Steven P Sanderson II, MPH"
date: "`r Sys.Date()`"
output: 
    ioslides_presentation:
        logo: healthyverse.png
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(tidyquant)
library(healthyverse)
```

## About Me

Name - Steven P Sanderson II, MPH

Education:

- BA Economics: SUNY Stony Brook University
- MPH: SUNY Stony Brook University

Employment:

- Data Scientist/IT Manager: NYU Langone Health at Long Island Community Hospital
- Head Data Scientist: Manchu Technologies Corp. (Consulting in `SQL`, `R`)

Developer:

- `healthyverse` packages.

## Sites

GitHub: https://github.com/spsanderson

LinkedIn: https://www.linkedin.com/in/spsanderson/

Personal: https://www.spsanderson.com

## Interests

- Data Analysis
- R (probably obvious)
- Plex Server (Music is life) - Is 88K mp3's to much? NO!

## How I got Started

I got started with R in my first job out of undergrad.

Employer: "Do you know SQL and any other analysis programming?"
Me: Yes, not a problem at all.

Reality...a little different, maybe an alternative fact.

SO...Google Searching...saved the day? YES!

## What are we going to talk about

So what are we going to discuss today?

The `healthyverse` suite of packages.

## Healthyverse Packages

There are currently five packages in the `healthyverse`


| Package | r-universe badge |
|:-------:|:----------------:|
| `healthyR` |  [![healthyR status badge](https://spsanderson.r-universe.dev/badges/healthyR)](https://spsanderson.r-universe.dev) |
| `healthyR.data` |  [![healthyR.data status badge](https://spsanderson.r-universe.dev/badges/healthyR.data)](https://spsanderson.r-universe.dev) |
| `healthyR.ai` | [![healthyR.ai status badge](https://spsanderson.r-universe.dev/badges/healthyR.ai)](https://spsanderson.r-universe.dev) |
| `healthyR.ts` | [![healthyR.ts status badge](https://spsanderson.r-universe.dev/badges/healthyR.ts)](https://spsanderson.r-universe.dev) |
| `TidyDensity` | [![TidyDensity status badge](https://spsanderson.r-universe.dev/badges/TidyDensity)](https://spsanderson.r-universe.dev) |

The `healthyverse` package is really just a meta package like tidyverse.

## The Begining

First came `healthyR`

| Badge Type | Badge Value |
|:----:|:-----:|
|CRAN Version | [![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/healthyR)](https://cran.r-project.org/package=healthyR)|
| r-universe | [![healthyR status badge](https://spsanderson.r-universe.dev/badges/healthyR)](https://spsanderson.r-universe.dev) |
| Monthly Downloads | ![](https://cranlogs.r-pkg.org/badges/healthyR) |
| Total Downloads | ![](https://cranlogs.r-pkg.org/badges/grand-total/healthyR) |
| Lifecycle | [![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html##experimental) |
| Pull Requests | [![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square)](https://makeapullrequest.com) |

## `healthyR`

Current Stats

- Has some functionality that can be useful right out of the gate
- Plotting functions like `los_ra_index_plt()`, `kmeans_scree_plt()`, and `gartner_magic_chart_plt()`

## LOS RA Index Plot
This plot takes place at the end of a work flow. Let's take a look at an example. First we need some data.

```{r warning=FALSE, message=FALSE}
set.seed(123)
data_tbl <- tibble(
  "alos"                 = rnorm(186, 6.5, 3)
  , "elos"               = rnorm(186, 6, 3)
  , "readmit_rate"       = rnorm(186, .1, .05)
  , "readmit_rate_bench" = rnorm(186, .075, .05)
)

data_tbl
```

## LOS RA Index Plot (summary)
Now that we have our data, let's take a look at the summary table.

```{r warning=FALSE, message=FALSE}
summary_tbl <- los_ra_index_summary_tbl(
  .data = data_tbl
  , .max_los       = 12
  , .alos_col      = alos
  , .elos_col      = elos
  , .readmit_rate  = readmit_rate
  , .readmit_bench = readmit_rate_bench
)

summary_tbl
```

## LOS RA Index Plot (plot)

Now lets take a look at the resulting plot and discuss what it tells us.

```{r warning=FALSE, message=FALSE}
los_ra_index_plt(summary_tbl)
```

## K-Means

What is it? In it's simplest form, K-Means will partition data into K non-overlapping clusters.

Example? Think a bank wanting to give people credit cards, this is a clustering
problem, high income, average income, low income, etc.

It's easy to understand how many applications this has.

Healthcare is no different.

## Scree Plot

We are only going to focus on the scree plot. This helps us to decide how many
clusters are in our data.

This plot is also many times referred to as the elbow plot.

## Example

```{r warning=FALSE, message=FALSE}
data_tbl <- healthyR_data%>%
   filter(ip_op_flag == "I") %>%
   filter(payer_grouping != "Medicare B") %>%
   filter(payer_grouping != "?") %>%
   select(service_line, payer_grouping) %>%
   mutate(record = 1) %>%
   as_tibble()

ui_tbl <-  kmeans_user_item_tbl(
   .data           = data_tbl
   , .row_input    = service_line
   , .col_input    =  payer_grouping
   , .record_input = record
 )

kmm_tbl <- kmeans_mapped_tbl(ui_tbl)

kmeans_scree_plt(.data = kmm_tbl)
```

## What Just Happened?

What just happened? Magic? Maybe?

First the data. Using the `healthyR_data` from my package `healthyR.data` we get a tibble of records with a service line and a payer grouping.

A patients service line is the row record and the payer grouping is the item, this gives us the user item matrix we need.

Next we get a tibble with multiple centers via the function `kmeans_mapped_tbl()`

Lastly, we plot that mapped tibble.

## Magic Chart

Have you seen the Gartner Magic Quadrant Chart?

If so, then you know, if not, then I'll show.

First let's take a look at the function call.

## Function Call

```{r, eval=FALSE, echo=TRUE}
gartner_magic_chart_plt(
  .data = tibble::tibble(
      x = rnorm(100, 0, 1)
      , y = rnorm(100,0,1)
  )
  , .x_col = x
  , .y_col = y
  , .x_lab = "LOS"
  , .y_lab = "Readmit"
  , .plt_title = "Test Plot"
  , .tr_lbl = "High RA-LOS"
  , .tl_lbl = "High RA"
  , .bl_lbl = "Leader"
  , .br_lbl = "High LOS"
)
```

## Plot Output

```{r}
gartner_magic_chart_plt(
  .data = tibble::tibble(
      x = rnorm(100, 0, 1)
      , y = rnorm(100,0,1)
  )
  , .x_col = x
  , .y_col = y
  , .x_lab = "LOS"
  , .y_lab = "Readmit"
  , .plt_title = "Test Plot"
  , .tr_lbl = "High RA-LOS"
  , .tl_lbl = "High RA"
  , .bl_lbl = "Leader"
  , .br_lbl = "High LOS"
)
```

## `healthyR.ts`

What is `healthyR.ts`

[Site: www.spsanderson.com/healthyR.ts](www.spsanderson.com/healthyR.ts)

The intent is that it be a easy to use verb framework for quick modeling of
time-series data.

In this section we are going to go over the processes of model tuning.

## Time Series Data

For this we use the internal `AirPassengers` dataset.

```{r, echo=TRUE}
data_ts <- AirPassengers

head(data_ts)
```

## Transform to `tibble` 

Most of the work done inside of `healthyR.ts` requires the use of a `tibble`, and where a `ts` object can be used, it is typically converted to a `tibble` internally to the function. This is done on purpose so that it works well with the rest of the `tidyverse`

```{r echo=TRUE}
data_tbl <- ts_to_tbl(data_ts) %>%
  select(-index)

head(data_tbl, 5)
```

## `healthyR.ai`

## `healthyR.data`

## `TidyDensity`